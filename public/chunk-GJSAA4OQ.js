import{f as D,g as P}from"./chunk-VX3KMHVW.js";import{Da as _,Ha as h,N as l,Na as f,Qa as v,Wa as S,Za as p,g as y,kb as k,za as C}from"./chunk-353TJUNG.js";import{a,b as d,h as T}from"./chunk-FK42CRUA.js";var I=13,A=7;var K=16,g=(o=>(o.club="club",o.diamond="diamond",o.heart="heart",o.spade="spade",o))(g||{});var b=[{color:"black",type:"club"},{color:"red",type:"diamond"},{color:"black",type:"spade"},{color:"red",type:"heart"}];var R=[{name:"sepia 1 color",source:"deck_classic_sepia_1color_0"},{name:"sepia 2 color",source:"deck_classic_sepia_2color_0"},{name:"dark 1 color",source:"deck_classic_dark_1color_0"},{name:"dark 2 color",source:"deck_classic_dark_2color_0"},{name:"light 1 color",source:"deck_classic_light_1color_0"},{name:"light 2 color",source:"deck_classic_light_2color_0"},{name:"light 4 color A",source:"deck_classic_light_4color_0"},{name:"light 4 color B",source:"deck_classic_light_4color_1"},{name:"light 4 color C",source:"deck_classic_light_4color_2"}],u=R[5];var m=class i{_cardTheme=new y(u);get cardTheme(){return this._cardTheme}static \u0275fac=function(t){return new(t||i)};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};function F(i,e){if(i&1&&S(0,"div",0),i&2){let t=p();f("ngStyle",t.getCardStyle())}}function O(i,e){if(i&1&&S(0,"div",1),i&2){let t=p(2);f("ngStyle",t.getCardStyle(t.card))}}function j(i,e){if(i&1&&h(0,O,1,1,"div",1),i&2){let t=p();v(t.card?0:-1)}}var V=4,H=24,N=40,B=60,E=class i{constructor(e,t){this.configService=e;this.changeDetectorRef=t}card;visible=!1;cardTypes=g;themeSub;cardTheme=u;ngOnInit(){this.themeSub=this.configService.cardTheme.subscribe(this.onCardTheme.bind(this))}ngOnDestroy(){this.themeSub?.unsubscribe()}onCardTheme(e){this.cardTheme=e,this.changeDetectorRef.detectChanges()}getCardStyle(e){let t=this.getTypeCoords(e);return{"background-image":`url(/assets/cards/${this.cardTheme.source}.png)`,"background-position":`-${t.x}px -${t.y}px`}}getTypeCoords(e){return e?this.getCoordsToPx({x:e.number,y:this.getRowPosition(e)}):this.getCoordsToPx({x:14,y:4})}getCoordsToPx(e){return{x:N*(e.x-1)+H*(e.x-1),y:B*(e.y-1)+V*(e.y-1)}}getRowPosition(e){if(e)switch(e.type){case"club":return 3;case"diamond":return 4;case"heart":return 2;case"spade":return 1}return 4}static \u0275fac=function(t){return new(t||i)(C(m),C(k))};static \u0275cmp=_({type:i,selectors:[["app-card"]],inputs:{card:"card",visible:"visible"},decls:2,vars:1,consts:[[1,"card","hidden",3,"ngStyle"],[1,"card",3,"ngStyle"]],template:function(t,r){t&1&&h(0,F,1,1,"div",0)(1,j,1,1),t&2&&v(r.visible?1:0)},dependencies:[P,D],styles:["[_nghost-%COMP%]{position:relative;width:var(--card-width);height:var(--card-height);display:flex}.card[_ngcontent-%COMP%]{position:absolute;top:0!important;left:0!important;width:100%!important;height:100%!important;overflow:hidden!important}"],changeDetection:0})};var c=class i{wait(e){return T(this,null,function*(){return new Promise(t=>setTimeout(t,e))})}getOffset(e){let t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}}static deepClone(e,t=structuredClone){return typeof t=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}static \u0275fac=function(t){return new(t||i)};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};var M=class i{solve(e,t,r=null){let o=this.spliceCards(e,t);if(o.cards.length===0)return d(a({},e),{spliced:o,moved:!1});if(r!==null){if(!this.isDropValid(e,o.cards[0],r))return d(a({},e),{spliced:o,moved:!1})}else r=this.getDroppableStock(e,o.cards[0],o.cards.length>1);return r===null?d(a({},e),{spliced:o,moved:!1}):d(a({},this.makeMove(e,t,o,r)),{spliced:o,to:r,moved:!0})}shuffle(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1)),o=e[t];e[t]=e[r],e[r]=o}return e}consecutiveArray(e,t){let r=[];for(let o=e;o<=t;o++)r.push(o);return r}generateGame(){let e=this.generatePiles(this.shuffle(this.generateDecks(b,I)),A);return{stock:e.mod,activeStock:[],piles:e.piles,solvedPiles:e.solvedPiles,foundations:this.fillArray([],b.length)}}generatePiles(e,t){let r=this.fillArray([],t),o=this.fillArray([],t);for(let n=0;n<t;n++)o[n].push(e.shift()),r[n]=e.splice(0,n);return{piles:r,solvedPiles:o,mod:e}}fillArray(e,t){let r=t-e.length;for(let o=0;o<r;o++)e.push([]);return e}generateDecks(e,t){let r=[],o=e.length;for(let n=0;n<o;n++)r=r.concat(this.generateDeck(e[n].type,e[n].color,t));return r}generateDeck(e,t,r){let o=[];for(let n=1;n<=r;n++)o.push({number:n,color:t,type:e});return o}isValidMove(e,t,r){return!e||!t?!1:r?e.number+1===t.number&&e.type===t.type:e.number-1===t.number&&e.color!==t.color}solveStock(e){let t=c.deepClone(e);return t.stock.length>0?(t.activeStock.push(t.stock.pop()),t.activeStock=[...t.activeStock],t.stock=[...t.stock]):(t.stock=t.activeStock.reverse(),t.activeStock=[]),t}makeMove(e,t,r,o){if(e[t.prop]=[...r.game[t.prop]],e[o.prop][o.index]=[...e[o.prop][o.index].concat(r.cards)],t.prop==="solvedPiles"&&e.solvedPiles[t.pileIndex].length===0&&e.piles[t.pileIndex].length>0){let n=e.piles[t.pileIndex].pop();e.solvedPiles[t.pileIndex].push(n),e.solvedPiles=[...e.solvedPiles],e.piles=c.deepClone(e.piles)}return e}isDropValid(e,t,r){switch(r.prop){case"foundations":return this.isDropValidFoundation(e,t,r);case"solvedPiles":return this.isDropValidSolvedPiles(e,t,r)}}isDropValidFoundation(e,t,r){let o=e.foundations[r.index];return Array.isArray(o)?o.length===0&&t.number===1?!0:this.isValidMove(o[o.length-1],t,!0):!1}isDropValidSolvedPiles(e,t,r){let o=e.solvedPiles[r.index];return Array.isArray(o)?o.length===0&&e.piles[r.index].length===0&&t.number===13?!0:this.isValidMove(o[o.length-1],t,!1):!1}getDroppableStock(e,t,r){let o=-1;return!r&&(o=this.getDroppableFoundation(e,t),o>-1)?{prop:"foundations",index:o}:(o=this.getDroppableSolvedPile(e,t),o>-1?{prop:"solvedPiles",index:o}:null)}getDroppableSolvedPile(e,t){let r=e.solvedPiles.length,o=this.shuffle(this.consecutiveArray(0,r-1));for(let n=0;n<r;n++){let s=e.solvedPiles[o[n]];if(s.length===0){if(t.number===13&&e.piles[o[n]].length===0)return o[n]}else if(this.isValidMove(s[s.length-1],t,!1))return o[n]}return-1}getDroppableFoundation(e,t){let r=e.foundations.length;for(let o=0;o<r;o++)if(e.foundations[o].length===0?t.number===1:this.isValidMove(e.foundations[o][e.foundations[o].length-1],t,!0))return o;return-1}spliceCards(e,t){let r=c.deepClone(e);switch(t.prop){case"activeStock":if(r.activeStock.length>0){let s=r.activeStock.pop();return r.activeStock=[...r.activeStock],{game:r,cards:[s]}}return{game:r,cards:[]};case"foundations":case"solvedPiles":let o=r[t.prop][t.pileIndex],n=o.length;if(n>0){if(t.prop==="foundations"){let L=r.foundations[t.pileIndex].pop();return r.foundations[t.pileIndex]=[...r.foundations[t.pileIndex]],{game:r,cards:[L]}}let s=typeof t.cardIndex<"u"&&t.cardIndex>-1?t.cardIndex:n-1,w=o.splice(s);return r[t.prop][t.pileIndex]=[...r[t.prop][t.pileIndex]],{game:r,cards:w}}}return{game:r,cards:[]}}isSameCard(e,t){return!!(e&&t&&e.color===t.color&&e.number===t.number&&e.type===t.type)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};export{K as a,m as b,E as c,c as d,M as e};
